import{r as n,j as e}from"./index-OtPSfN_w.js";import{u as N,b as M}from"./components-C9-D01ZZ.js";import{P as J,I as i,b as h,T as s,C as g,c as r,d as P,a as k,B as U}from"./Page-DvMnY4Uh.js";import{L as o}from"./Layout-BvDTjT3E.js";import{B as b,C as O}from"./Banner-DRkmBrND.js";import{S as I}from"./CheckCircleIcon.svg-BdEOQivI.js";import{S as R,D as S,a as V}from"./Divider-DCXs5LYm.js";import{F as D}from"./FormLayout-9MUjKHGm.js";import{S as _}from"./Select-DS1yuizv.js";import{S as q}from"./ClockIcon.svg-Dq65wAvQ.js";import"./context-C9td0CMk.js";import"./banner-context-Bfu3e4If.js";function re(){var v,y,E,T,C;const{setting:d}=N(),x=M(),a=M(),[c,w]=n.useState(d.autoUpdateEnabled),[l,B]=n.useState(d.minPricePct.toString()),[f,F]=n.useState(d.autoUpdateHour.toString()),[u,$]=n.useState(d.notificationEmail||""),[H,m]=n.useState(!1),[W,p]=n.useState(!1);n.useEffect(()=>{var t;if((t=x.data)!=null&&t.success){m(!0);const j=setTimeout(()=>m(!1),3e3);return()=>clearTimeout(j)}},[x.data]),n.useEffect(()=>{if(a.data){p(!0);const t=setTimeout(()=>p(!1),5e3);return()=>clearTimeout(t)}},[a.data]);const L=[...Array(24)].map((t,j)=>({label:`${String(j).padStart(2,"0")}:00`,value:j.toString()})),A=()=>{const t=new FormData;t.append("autoUpdateEnabled",c.toString()),t.append("minPricePct",l),t.append("autoUpdateHour",f),t.append("notificationEmail",u),x.submit(t,{method:"post"})},z=()=>{a.submit({},{method:"post",action:"/api/test-email"})};return e.jsx(J,{title:"アプリ設定",subtitle:"自動価格調整の設定を管理します",titleMetadata:e.jsx(P,{tone:"info",children:"V2.0"}),children:e.jsxs(o,{children:[H&&e.jsx(o.Section,{children:e.jsx(b,{tone:"success",onDismiss:()=>m(!1),children:e.jsxs(i,{gap:"200",align:"center",children:[e.jsx(h,{source:I,tone:"success"}),e.jsx(s,{children:"設定が正常に保存されました"})]})})}),W&&e.jsx(o.Section,{children:e.jsx(b,{tone:(v=a.data)!=null&&v.success?"success":"critical",onDismiss:()=>p(!1),children:e.jsxs(i,{gap:"200",align:"center",children:[e.jsx(h,{source:I,tone:(y=a.data)!=null&&y.success?"success":"critical"}),e.jsx(s,{children:(E=a.data)!=null&&E.success?`テストメールを送信しました: ${(T=a.data)==null?void 0:T.email}`:`テストメール送信失敗: ${(C=a.data)==null?void 0:C.error}`})]})})}),e.jsx(o.Section,{children:e.jsx(g,{children:e.jsxs(r,{gap:"500",children:[e.jsxs(i,{gap:"300",align:"start",children:[e.jsx(h,{source:R,tone:"base"}),e.jsxs(r,{gap:"200",children:[e.jsx(s,{variant:"headingMd",as:"h2",children:"自動更新設定"}),e.jsx(s,{variant:"bodySm",tone:"subdued",children:"田中貴金属の価格変動に基づいて商品価格を自動調整します"})]})]}),e.jsx(S,{}),e.jsxs(D,{children:[e.jsx(O,{label:"自動更新を有効化",helpText:"有効にすると設定時刻に自動で価格調整が実行されます",checked:c,onChange:w}),e.jsxs(i,{gap:"400",align:"start",children:[e.jsx("div",{style:{minWidth:"200px"},children:e.jsx(_,{label:"自動更新時刻（JST）",options:L,value:f,onChange:F,disabled:!c})}),e.jsx("div",{style:{paddingTop:"24px"},children:e.jsx(P,{tone:c?"info":"warning",children:c?"有効":"無効"})})]}),e.jsx(k,{label:"価格下限設定（%）",type:"number",value:l,onChange:B,min:1,max:100,suffix:"%",helpText:`現在価格の${l}%を下限として保護します（例: ${l}% = ${100-parseInt(l)}%以上下がらない）`})]})]})})}),e.jsx(o.Section,{children:e.jsx(g,{children:e.jsxs(r,{gap:"500",children:[e.jsxs(i,{gap:"300",align:"start",children:[e.jsx(h,{source:V,tone:"base"}),e.jsxs(r,{gap:"200",children:[e.jsx(s,{variant:"headingMd",as:"h2",children:"通知設定"}),e.jsx(s,{variant:"bodySm",tone:"subdued",children:"価格更新の実行結果やエラーを通知します"})]})]}),e.jsx(S,{}),e.jsxs(D,{children:[e.jsx(k,{label:"通知メールアドレス（任意）",type:"email",value:u,onChange:$,placeholder:"you@example.com",helpText:"設定すると自動更新の結果がメールで通知されます"}),u&&e.jsxs(i,{gap:"200",align:"start",children:[e.jsx(U,{variant:"secondary",size:"medium",onClick:z,loading:a.state==="submitting",disabled:!u,children:"テストメール送信"}),e.jsx("div",{style:{paddingTop:"6px"},children:e.jsx(s,{variant:"bodySm",tone:"subdued",children:"設定したメールアドレスに通知のテストメールを送信します"})})]})]})]})})}),e.jsx(o.Section,{children:e.jsx(g,{children:e.jsxs(r,{gap:"500",children:[e.jsxs(i,{gap:"300",align:"start",children:[e.jsx(h,{source:q,tone:"base"}),e.jsxs(r,{gap:"200",children:[e.jsx(s,{variant:"headingMd",as:"h2",children:"実行スケジュール"}),e.jsx(s,{variant:"bodySm",tone:"subdued",children:"自動更新の実行タイミングについて"})]})]}),e.jsx(S,{}),e.jsxs(r,{gap:"300",children:[e.jsxs(i,{gap:"600",children:[e.jsxs("div",{children:[e.jsx(s,{variant:"bodyMd",as:"p",fontWeight:"semibold",children:"実行曜日"}),e.jsx(s,{variant:"bodySm",tone:"subdued",children:"平日（月〜金曜日）"})]}),e.jsxs("div",{children:[e.jsx(s,{variant:"bodyMd",as:"p",fontWeight:"semibold",children:"実行時刻"}),e.jsxs(s,{variant:"bodySm",tone:"subdued",children:[String(d.autoUpdateHour||10).padStart(2,"0"),":00（日本時間）"]})]}),e.jsxs("div",{children:[e.jsx(s,{variant:"bodyMd",as:"p",fontWeight:"semibold",children:"祝日対応"}),e.jsx(s,{variant:"bodySm",tone:"subdued",children:"自動的にスキップ"})]})]}),e.jsx(b,{tone:"success",children:e.jsxs(r,{gap:"200",children:[e.jsx(s,{fontWeight:"semibold",children:"🕙 自動更新スケジュール"}),e.jsxs(s,{children:["• ",e.jsx("strong",{children:"実行時刻:"})," 設定した時刻に自動実行",e.jsx("br",{}),"• ",e.jsx("strong",{children:"対象曜日:"})," 月曜日〜金曜日（平日のみ）",e.jsx("br",{}),"• ",e.jsx("strong",{children:"祝日:"})," 自動的にスキップ",e.jsx("br",{}),"• ",e.jsx("strong",{children:"実行条件:"})," 自動更新が有効で、対象商品が選択されている場合"]})]})})]})]})})}),e.jsx(o.Section,{children:e.jsx(i,{align:"end",children:e.jsx(U,{variant:"primary",size:"large",onClick:A,loading:x.state==="submitting",children:"設定を保存"})})})]})})}export{re as default};
